{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ê¸€ ìƒì„¸ ë³´ê¸°</title>
</head>
<body>
  <h1>{{ community.title }}</h1>
  <div>
    ì‘ì„±ì: {{ community.user.nickname }} | ì‘ì„±ì¼: {{ community.created_at|date:"Y-m-d H:i" }}
  </div>

  <div>
    {{ community.content|linebreaks }}
  </div>
<form action="{% url 'community:likes' community.pk %}" method="POST" style="display:inline;">
  {% csrf_token %}
  <button type="submit">
    {% if request.user in community.like_users.all %}
      â¤ï¸
    {% else %}
      ğŸ¤
    {% endif %}
    ({{ community.like_users.count }})
  </button>
</form>
  <div>
    <a href="{% url 'community:update' community.pk %}">ìˆ˜ì •</a>
    <a href="{% url 'community:delete' community.pk %}">ì‚­ì œ</a>
    <a href="{% url 'community:index' %}">ëª©ë¡ìœ¼ë¡œ</a>
  </div>

  <hr>
  <h3>ëŒ“ê¸€</h3>

  <!-- ëŒ“ê¸€ ëª©ë¡ -->
  <div>
    {% for comment in comments %}
      <div id="comment-{{ comment.pk }}">
        <div class="view-mode">
          <p>{{ comment.content }}</p>
         <small>
          ì‘ì„±ì: {{ comment.user.nickname }} |
{% with time=comment.created_at|timesince %}
  {% if time == "0 minutes" or time == "0ë¶„" %}
    ë°©ê¸ˆ ì „
  {% else %}
    {{ time }} ì „
  {% endif %}
{% endwith %}
          {% if comment.created_at != comment.updated_at %}(ìˆ˜ì •ë¨){% endif %}
</small>
          {% if comment.user == request.user %}
            <button onclick="enableEdit({{ comment.pk }})">ìˆ˜ì •</button>
            <form method="POST" action="{% url 'community:comments_delete' community.pk comment.pk %}" style="display:inline;">
              {% csrf_token %}
              <button type="submit">ì‚­ì œ</button>
            </form>
          {% endif %}
        </div>

        {% if comment.user == request.user %}
        <div class="edit-mode" style="display:none;">
          <form method="POST" action="{% url 'community:comments_update' community.pk comment.pk %}">
            {% csrf_token %}
            <textarea name="content" rows="2">{{ comment.content }}</textarea>
            <button type="submit">ì™„ë£Œ</button>
            <button type="button" onclick="cancelEdit({{ comment.pk }})">ì·¨ì†Œ</button>
          </form>
        </div>
        {% endif %}
      </div>
    {% endfor %}
  </div>

  <!-- ëŒ“ê¸€ ì‘ì„± -->
  <form method="POST" action="{% url 'community:comments_create' community.pk %}">
    {% csrf_token %}
    {{ comment_form.as_p }}
    <button type="submit">ëŒ“ê¸€ ì‘ì„±</button>
  </form>

  <script>
    function enableEdit(pk) {
      const wrapper = document.getElementById(`comment-${pk}`);
      wrapper.querySelector('.view-mode').style.display = 'none';
      wrapper.querySelector('.edit-mode').style.display = 'block';
    }

    function cancelEdit(pk) {
      const wrapper = document.getElementById(`comment-${pk}`);
      wrapper.querySelector('.view-mode').style.display = 'block';
      wrapper.querySelector('.edit-mode').style.display = 'none';
    }
  </script>
</body>
</html>
